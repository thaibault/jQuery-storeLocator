#!/usr/bin/env node

// -*- coding: utf-8 -*-
'use strict';
/* !
    region header
    Copyright Torben Sickert (info["~at~"]torben.website) 16.12.2012

    License
    -------

    This library written by Torben Sickert stand under a creative commons naming
    3.0 unported license. see http://creativecommons.org/licenses/by/3.0/deed.de
    endregion
*/
// region imports

var _child_process = require('child_process');

var _fs = require('fs');

var fileSystem = _interopRequireWildcard(_fs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _rimraf = require('rimraf');

var _configurator = require('./configurator.compiled');

var _configurator2 = _interopRequireDefault(_configurator);

var _helper = require('./helper.compiled');

var _helper2 = _interopRequireDefault(_helper);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

// NOTE: Only needed for debugging this file.
try {
    require('source-map-support/register');
} catch (error) {}

// endregion
// region controller
const childProcessOptions = {
    cwd: _configurator2.default.path.context,
    env: process.env,
    shell: true,
    stdio: 'inherit'
};
const closeEventNames = ['exit', 'close', 'uncaughtException', 'SIGINT', 'SIGTERM', 'SIGQUIT'];
const childProcesses = [];
const processPromises = [];
const possibleArguments = ['build', 'buildDLL', 'clear', 'document', 'lint', 'preinstall', 'test', 'testInBrowser', 'typeCheck'];
const closeEventHandlers = [];
if (_configurator2.default.givenCommandLineArguments.length > 2) {
    // region temporary save dynamically given configurations

    let dynamicConfiguration = {
        givenCommandLineArguments: _configurator2.default.givenCommandLineArguments.slice() };
    if (_configurator2.default.givenCommandLineArguments.length > 3) {
        const evaluationFunction = configuration =>
        // IgnoreTypeCheck
        new Function('configuration', 'return ' + configuration.givenCommandLineArguments[configuration.givenCommandLineArguments.length - 1])(configuration);
        try {
            if (_helper2.default.isPlainObject(evaluationFunction(_configurator2.default))) _configurator2.default.givenCommandLineArguments.pop();
        } catch (error) {}
    }
    let count = 0;
    let filePath = `${ _configurator2.default.path.context }.` + `dynamicConfiguration-${ count }.json`;
    while (true) {
        filePath = `${ _configurator2.default.path.context }.dynamicConfiguration-` + `${ count }.json`;
        try {
            fileSystem.accessSync(filePath, fileSystem.F_OK);
        } catch (error) {
            break;
        }
        count += 1;
    }
    fileSystem.writeFileSync(filePath, JSON.stringify(dynamicConfiguration));
    const additionalArguments = process.argv.splice(3);
    // / region register exit handler to tidy up
    closeEventHandlers.push(function (error) {
        try {
            fileSystem.unlinkSync(filePath);
        } catch (error) {}
        if (error) throw error;
        return error;
    });
    // / endregion
    // endregion
    // region handle clear
    /*
        NOTE: A build could depend on previously created dll packages so a
        clean should not be performed in that case.
    */
    if (!['build', 'serve', 'testInBrowser'].includes(_configurator2.default.givenCommandLineArguments[2]) && possibleArguments.includes(_configurator2.default.givenCommandLineArguments[2])) {
        if (_path2.default.resolve(_configurator2.default.path.target) === _path2.default.resolve(_configurator2.default.path.context)) {
            // Removes all compiled files.
            _helper2.default.walkDirectoryRecursivelySync(_configurator2.default.path.target, (filePath, stat) => {
                if (_helper2.default.isFilePathInLocation(filePath, _configurator2.default.path.ignore)) return false;
                for (const type in _configurator2.default.build) if (new RegExp(_configurator2.default.build[type].fileNamePattern).test(filePath)) {
                    if (stat.isDirectory()) {
                        (0, _rimraf.sync)(filePath, {
                            glob: false });
                        return false;
                    }
                    fileSystem.unlinkSync(filePath);
                    break;
                }
            });
            fileSystem.readdirSync(_configurator2.default.path.target).forEach(fileName => {
                if (fileName.length > '.dll-manifest.json'.length && fileName.endsWith('.dll-manifest.json')) fileSystem.unlinkSync(_path2.default.resolve(_configurator2.default.path.target, fileName));
            });
        } else (0, _rimraf.sync)(_configurator2.default.path.target, {
            glob: false });
        try {
            (0, _rimraf.sync)(_configurator2.default.path.apiDocumentation, { glob: false });
        } catch (error) {}
    }
    // endregion
    // region handle build
    const buildConfigurations = _helper2.default.resolveBuildConfigurationFilePaths(_configurator2.default.build, _configurator2.default.path.asset.source, _configurator2.default.path.context, _configurator2.default.path.ignore);
    if (['build', 'buildDLL', 'document', 'test'].includes(process.argv[2])) {
        const tidyUp = () => {
            /*
                Determines all none javaScript entities which have been emitted
                as single javaScript module to remove.
            */
            const internalInjection = _helper2.default.normalizeInternalInjection(_helper2.default.resolveInjection(_configurator2.default.injection, buildConfigurations, _configurator2.default.testInBrowser.injection.internal, _configurator2.default.module.aliases, _configurator2.default.knownExtensions, _configurator2.default.path.context, _configurator2.default.path.ignore).internal);
            for (const chunkName in internalInjection) if (internalInjection.hasOwnProperty(chunkName)) for (const moduleID of internalInjection[chunkName]) {
                const type = _helper2.default.determineAssetType(_helper2.default.determineModuleFilePath(moduleID), _configurator2.default.build, _configurator2.default.path);
                // TODO replace all placeholder like [hash] [id] ...
                const filePath = _configurator2.default.files.javaScript.replace('[name]', _path2.default.join(_path2.default.relative(_path2.default.dirname(moduleID), _configurator2.default.path.context), _path2.default.basename(moduleID))).replace(/\?[^?]+$/, '');
                if (typeof type === 'string' && _configurator2.default.build[type]) if (_configurator2.default.build[type].outputExtension === 'js') try {
                    fileSystem.chmodSync(filePath, '755');
                } catch (error) {} else for (const suffix of ['', '.map']) try {
                    fileSystem.unlinkSync(filePath + suffix);
                } catch (error) {}
            }
            for (const filePath of _configurator2.default.path.tidyUp) try {
                fileSystem.unlinkSync(filePath);
            } catch (error) {}
        };
        closeEventHandlers.push(tidyUp);
        /*
            Triggers complete asset compiling and bundles them into the final
            productive output.
        */
        processPromises.push(new Promise((resolve, reject) => {
            const childProcess = (0, _child_process.spawn)(_configurator2.default.commandLine.build.command, (_configurator2.default.commandLine.build.arguments || []).concat(additionalArguments), childProcessOptions);
            for (const closeEventName of closeEventNames) childProcess.on(closeEventName, returnCode => {
                if (typeof returnCode !== 'number' || returnCode === 0) tidyUp();else reject(new Error(`Task exited with error code ${ returnCode }`));
            });
            childProcesses.push(childProcess);
        }));
        // endregion
        // region handle preinstall
    } else if (_configurator2.default.library && _configurator2.default.givenCommandLineArguments[2] === 'preinstall') {
            // Perform all file specific preprocessing stuff.
            const testModuleFilePaths = _helper2.default.determineModuleLocations(_configurator2.default.testInBrowser.injection.internal, _configurator2.default.module.aliases, _configurator2.default.knownExtensions, _configurator2.default.path.context, _configurator2.default.path.ignore).filePaths;
            for (const buildConfiguration of buildConfigurations) for (const filePath of buildConfiguration.filePaths) if (!testModuleFilePaths.includes(filePath)) {
                const evaluationFunction = (global, self, buildConfiguration, path, additionalArguments, filePath) =>
                // IgnoreTypeCheck
                new Function('global', 'self', 'buildConfiguration', 'path', 'additionalArguments', 'filePath', 'return `' + buildConfiguration[_configurator2.default.givenCommandLineArguments[2]] + '`')(global, self, buildConfiguration, path, additionalArguments, filePath);
                processPromises.push(new Promise((resolve, reject) => _helper2.default.handleChildProcess((0, _child_process.exec)(evaluationFunction(global, _configurator2.default, buildConfiguration, _path2.default, additionalArguments, filePath), childProcessOptions, error => {
                    if (error) reject(error);else resolve();
                }))));
            }
        }
    // endregion
    // region handle remaining tasks
    const handleTask = type => processPromises.push(new Promise((resolve, reject) => {
        const childProcess = (0, _child_process.spawn)(_configurator2.default.commandLine[type].command, (_configurator2.default.commandLine[type].arguments || []).concat(additionalArguments), childProcessOptions);
        childProcess.on('close', returnCode => {
            if (returnCode === 0) resolve();else reject(returnCode);
        });
        childProcesses.push(childProcess);
    }));
    // / region synchronous
    for (const type of ['document', 'test']) if (_configurator2.default.givenCommandLineArguments[2] === type) {
        Promise.all(processPromises).then(() => handleTask(type));
        break;
    }
    // / endregion
    // / region asynchronous
    for (const type of ['lint', 'testInBrowser', 'typeCheck', 'serve']) if (_configurator2.default.givenCommandLineArguments[2] === type) {
        handleTask(type);
        break;
    }
    // / endregion
    // endregion
}
let finished = false;
const closeHandler = function () {
    if (!finished) for (const closeEventHandler of closeEventHandlers) closeEventHandler.apply(this, arguments);
    finished = true;
    process.exit();
};
for (const closeEventName of closeEventNames) process.on(closeEventName, closeHandler);
if (!_configurator2.default.library) possibleArguments.push('serve');
// IgnoreTypeCheck
if (require.main === module && (_configurator2.default.givenCommandLineArguments.length < 3 || !possibleArguments.includes(_configurator2.default.givenCommandLineArguments[2]))) console.log(`Give one of "${ possibleArguments.join('", "') }" as command line ` + 'argument. You can provide a json string as second parameter to ' + 'dynamically overwrite some configurations.\n');
// endregion
// region forward nested return codes
Promise.all(processPromises).catch(returnCode => process.exit(returnCode));
// endregion
// region vim modline
// vim: set tabstop=4 shiftwidth=4 expandtab:
// vim: foldmethod=marker foldmarker=region,endregion:
// endregion

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRhc2tSdW5uZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUVBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUFXQTs7QUFDQTs7QUFHQTs7SUFBWSxVOztBQUNaOzs7O0FBQ0E7O0FBTUE7Ozs7QUFLQTs7Ozs7Ozs7QUFWQTtBQUNBLElBQUk7QUFDQSxZQUFRLDZCQUFSO0FBQ0gsQ0FGRCxDQUVFLE9BQU8sS0FBUCxFQUFjLENBQUU7O0FBUWxCO0FBQ0E7QUFDQSxNQUFNLHNCQUE2QjtBQUMvQixTQUFLLHVCQUFjLElBQWQsQ0FBbUIsT0FETztBQUUvQixTQUFLLFFBQVEsR0FGa0I7QUFHL0IsV0FBTyxJQUh3QjtBQUkvQixXQUFPO0FBSndCLENBQW5DO0FBTUEsTUFBTSxrQkFBZ0MsQ0FDbEMsTUFEa0MsRUFDMUIsT0FEMEIsRUFDakIsbUJBRGlCLEVBQ0ksUUFESixFQUNjLFNBRGQsRUFDeUIsU0FEekIsQ0FBdEM7QUFFQSxNQUFNLGlCQUFxQyxFQUEzQztBQUNBLE1BQU0sa0JBQXNDLEVBQTVDO0FBQ0EsTUFBTSxvQkFBa0MsQ0FDcEMsT0FEb0MsRUFDM0IsVUFEMkIsRUFDZixPQURlLEVBQ04sVUFETSxFQUNNLE1BRE4sRUFDYyxZQURkLEVBQzRCLE1BRDVCLEVBRXBDLGVBRm9DLEVBRW5CLFdBRm1CLENBQXhDO0FBSUEsTUFBTSxxQkFBcUMsRUFBM0M7QUFDQSxJQUFJLHVCQUFjLHlCQUFkLENBQXdDLE1BQXhDLEdBQWlELENBQXJELEVBQXdEO0FBQ3BEOztBQUVBLFFBQUksdUJBQW1DO0FBQ25DLG1DQUNJLHVCQUFjLHlCQUFkLENBQXdDLEtBQXhDLEVBRitCLEVBQXZDO0FBR0EsUUFBSSx1QkFBYyx5QkFBZCxDQUF3QyxNQUF4QyxHQUFpRCxDQUFyRCxFQUF3RDtBQUNwRCxjQUFNLHFCQUNGLGFBRHVCO0FBR3ZCO0FBQ0EsWUFBSSxRQUFKLENBQWEsZUFBYixFQUE4QixZQUMxQixjQUFjLHlCQUFkLENBQ0ksY0FBYyx5QkFBZCxDQUF3QyxNQUF4QyxHQUFpRCxDQURyRCxDQURKLEVBR0UsYUFIRixDQUpKO0FBUUEsWUFBSTtBQUNBLGdCQUFJLGlCQUFPLGFBQVAsQ0FBcUIsMENBQXJCLENBQUosRUFDSSx1QkFBYyx5QkFBZCxDQUF3QyxHQUF4QztBQUNQLFNBSEQsQ0FHRSxPQUFPLEtBQVAsRUFBYyxDQUFFO0FBQ3JCO0FBQ0QsUUFBSSxRQUFlLENBQW5CO0FBQ0EsUUFBSSxXQUFtQixJQUFFLHVCQUFjLElBQWQsQ0FBbUIsT0FBUSxJQUE5QixHQUNqQix5QkFBdUIsS0FBTSxRQURsQztBQUVBLFdBQU8sSUFBUCxFQUFhO0FBQ1QsbUJBQVksSUFBRSx1QkFBYyxJQUFkLENBQW1CLE9BQVEseUJBQTlCLEdBQ04sSUFBRSxLQUFNLFFBRGI7QUFFQSxZQUFJO0FBQ0EsdUJBQVcsVUFBWCxDQUFzQixRQUF0QixFQUFnQyxXQUFXLElBQTNDO0FBQ0gsU0FGRCxDQUVFLE9BQU8sS0FBUCxFQUFjO0FBQ1o7QUFDSDtBQUNELGlCQUFTLENBQVQ7QUFDSDtBQUNELGVBQVcsYUFBWCxDQUF5QixRQUF6QixFQUFtQyxLQUFLLFNBQUwsQ0FBZSxvQkFBZixDQUFuQztBQUNBLFVBQU0sc0JBQW9DLFFBQVEsSUFBUixDQUFhLE1BQWIsQ0FBb0IsQ0FBcEIsQ0FBMUM7QUFDQTtBQUNBLHVCQUFtQixJQUFuQixDQUF3QixVQUFTLEtBQVQsRUFBOEI7QUFDbEQsWUFBSTtBQUNBLHVCQUFXLFVBQVgsQ0FBc0IsUUFBdEI7QUFDSCxTQUZELENBRUUsT0FBTyxLQUFQLEVBQWMsQ0FBRTtBQUNsQixZQUFJLEtBQUosRUFDSSxNQUFNLEtBQU47QUFDSixlQUFPLEtBQVA7QUFDSCxLQVBEO0FBUUE7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQSxRQUFJLENBQUMsQ0FBQyxPQUFELEVBQVUsT0FBVixFQUFtQixlQUFuQixFQUFvQyxRQUFwQyxDQUNELHVCQUFjLHlCQUFkLENBQXdDLENBQXhDLENBREMsQ0FBRCxJQUVDLGtCQUFrQixRQUFsQixDQUNELHVCQUFjLHlCQUFkLENBQXdDLENBQXhDLENBREMsQ0FGTCxFQUlHO0FBQ0MsWUFBSSxlQUFLLE9BQUwsQ0FBYSx1QkFBYyxJQUFkLENBQW1CLE1BQWhDLE1BQTRDLGVBQUssT0FBTCxDQUM1Qyx1QkFBYyxJQUFkLENBQW1CLE9BRHlCLENBQWhELEVBRUc7QUFDQztBQUNBLDZCQUFPLDRCQUFQLENBQW9DLHVCQUFjLElBQWQsQ0FBbUIsTUFBdkQsRUFBK0QsQ0FDM0QsUUFEMkQsRUFDMUMsSUFEMEMsS0FFakQ7QUFDVixvQkFBSSxpQkFBTyxvQkFBUCxDQUNBLFFBREEsRUFDVSx1QkFBYyxJQUFkLENBQW1CLE1BRDdCLENBQUosRUFHSSxPQUFPLEtBQVA7QUFDSixxQkFBSyxNQUFNLElBQVgsSUFBMEIsdUJBQWMsS0FBeEMsRUFDSSxJQUFJLElBQUksTUFBSixDQUNBLHVCQUFjLEtBQWQsQ0FBb0IsSUFBcEIsRUFBMEIsZUFEMUIsRUFFRixJQUZFLENBRUcsUUFGSCxDQUFKLEVBRWtCO0FBQ2Qsd0JBQUksS0FBSyxXQUFMLEVBQUosRUFBd0I7QUFDcEIsMENBQStCLFFBQS9CLEVBQXlDO0FBQ3JDLGtDQUFNLEtBRCtCLEVBQXpDO0FBRUEsK0JBQU8sS0FBUDtBQUNIO0FBQ0QsK0JBQVcsVUFBWCxDQUFzQixRQUF0QjtBQUNBO0FBQ0g7QUFDUixhQW5CRDtBQW9CQSx1QkFBVyxXQUFYLENBQXVCLHVCQUFjLElBQWQsQ0FBbUIsTUFBMUMsRUFBa0QsT0FBbEQsQ0FDSSxRQURzRCxJQUVoRDtBQUNOLG9CQUNJLFNBQVMsTUFBVCxHQUFrQixxQkFBcUIsTUFBdkMsSUFDQSxTQUFTLFFBQVQsQ0FBa0Isb0JBQWxCLENBRkosRUFJSSxXQUFXLFVBQVgsQ0FBc0IsZUFBSyxPQUFMLENBQ2xCLHVCQUFjLElBQWQsQ0FBbUIsTUFERCxFQUNTLFFBRFQsQ0FBdEI7QUFFUCxhQVREO0FBVUgsU0FsQ0QsTUFtQ0ksa0JBQStCLHVCQUFjLElBQWQsQ0FBbUIsTUFBbEQsRUFBMEQ7QUFDdEQsa0JBQU0sS0FEZ0QsRUFBMUQ7QUFFSixZQUFJO0FBQ0EsOEJBQ0ksdUJBQWMsSUFBZCxDQUFtQixnQkFEdkIsRUFDeUMsRUFBQyxNQUFNLEtBQVAsRUFEekM7QUFFSCxTQUhELENBR0UsT0FBTyxLQUFQLEVBQWMsQ0FBRTtBQUNyQjtBQUNEO0FBQ0E7QUFDQSxVQUFNLHNCQUNGLGlCQUFPLGtDQUFQLENBQ0ksdUJBQWMsS0FEbEIsRUFDeUIsdUJBQWMsSUFBZCxDQUFtQixLQUFuQixDQUF5QixNQURsRCxFQUVJLHVCQUFjLElBQWQsQ0FBbUIsT0FGdkIsRUFFZ0MsdUJBQWMsSUFBZCxDQUFtQixNQUZuRCxDQURKO0FBSUEsUUFBSSxDQUFDLE9BQUQsRUFBVSxVQUFWLEVBQXNCLFVBQXRCLEVBQWtDLE1BQWxDLEVBQTBDLFFBQTFDLENBQW1ELFFBQVEsSUFBUixDQUFhLENBQWIsQ0FBbkQsQ0FBSixFQUF5RTtBQUNyRSxjQUFNLFNBQVMsTUFBVztBQUN0Qjs7OztBQUlBLGtCQUFNLG9CQUNGLGlCQUFPLDBCQUFQLENBQ0ksaUJBQU8sZ0JBQVAsQ0FDSSx1QkFBYyxTQURsQixFQUVJLG1CQUZKLEVBR0ksdUJBQWMsYUFBZCxDQUE0QixTQUE1QixDQUFzQyxRQUgxQyxFQUlJLHVCQUFjLE1BQWQsQ0FBcUIsT0FKekIsRUFLSSx1QkFBYyxlQUxsQixFQU1JLHVCQUFjLElBQWQsQ0FBbUIsT0FOdkIsRUFPSSx1QkFBYyxJQUFkLENBQW1CLE1BUHZCLEVBUUUsUUFUTixDQURKO0FBV0EsaUJBQUssTUFBTSxTQUFYLElBQStCLGlCQUEvQixFQUNJLElBQUksa0JBQWtCLGNBQWxCLENBQWlDLFNBQWpDLENBQUosRUFDSSxLQUFLLE1BQU0sUUFBWCxJQUE4QixrQkFDMUIsU0FEMEIsQ0FBOUIsRUFFRztBQUNDLHNCQUFNLE9BQWUsaUJBQU8sa0JBQVAsQ0FDakIsaUJBQU8sdUJBQVAsQ0FBK0IsUUFBL0IsQ0FEaUIsRUFFakIsdUJBQWMsS0FGRyxFQUVJLHVCQUFjLElBRmxCLENBQXJCO0FBR0E7QUFDQSxzQkFBTSxXQUNGLHVCQUFjLEtBQWQsQ0FBb0IsVUFBcEIsQ0FBK0IsT0FBL0IsQ0FDSSxRQURKLEVBQ2MsZUFBSyxJQUFMLENBQVUsZUFBSyxRQUFMLENBQ2hCLGVBQUssT0FBTCxDQUFhLFFBQWIsQ0FEZ0IsRUFFaEIsdUJBQWMsSUFBZCxDQUFtQixPQUZILENBQVYsRUFHUCxlQUFLLFFBQUwsQ0FBYyxRQUFkLENBSE8sQ0FEZCxFQUtFLE9BTEYsQ0FLVSxVQUxWLEVBS3NCLEVBTHRCLENBREo7QUFPQSxvQkFBSSxPQUFPLElBQVAsS0FBZ0IsUUFBaEIsSUFBNEIsdUJBQWMsS0FBZCxDQUM1QixJQUQ0QixDQUFoQyxFQUdJLElBQUksdUJBQWMsS0FBZCxDQUNBLElBREEsRUFFRixlQUZFLEtBRWtCLElBRnRCLEVBR0ksSUFBSTtBQUNBLCtCQUFXLFNBQVgsQ0FBcUIsUUFBckIsRUFBK0IsS0FBL0I7QUFDSCxpQkFGRCxDQUVFLE9BQU8sS0FBUCxFQUFjLENBQUUsQ0FMdEIsTUFPSSxLQUFLLE1BQU0sTUFBWCxJQUE0QixDQUFDLEVBQUQsRUFBSyxNQUFMLENBQTVCLEVBQ0ksSUFBSTtBQUNBLCtCQUFXLFVBQVgsQ0FDSSxXQUFXLE1BRGY7QUFFSCxpQkFIRCxDQUdFLE9BQU8sS0FBUCxFQUFjLENBQUU7QUFDakM7QUFDVCxpQkFDSSxNQUFNLFFBRFYsSUFDNkIsdUJBQWMsSUFBZCxDQUFtQixNQURoRCxFQUdJLElBQUk7QUFDQSwyQkFBVyxVQUFYLENBQXNCLFFBQXRCO0FBQ0gsYUFGRCxDQUVFLE9BQU8sS0FBUCxFQUFjLENBQUU7QUFDekIsU0F0REQ7QUF1REEsMkJBQW1CLElBQW5CLENBQXdCLE1BQXhCO0FBQ0E7Ozs7QUFJQSx3QkFBZ0IsSUFBaEIsQ0FBcUIsSUFBSSxPQUFKLENBQVksQ0FDN0IsT0FENkIsRUFDSSxNQURKLEtBRXZCO0FBQ04sa0JBQU0sZUFBNEIsMEJBQzlCLHVCQUFjLFdBQWQsQ0FBMEIsS0FBMUIsQ0FBZ0MsT0FERixFQUNXLENBQ3JDLHVCQUFjLFdBQWQsQ0FBMEIsS0FBMUIsQ0FBZ0MsU0FBaEMsSUFBNkMsRUFEUixFQUV2QyxNQUZ1QyxDQUVoQyxtQkFGZ0MsQ0FEWCxFQUdDLG1CQUhELENBQWxDO0FBSUEsaUJBQUssTUFBTSxjQUFYLElBQW9DLGVBQXBDLEVBQ0ksYUFBYSxFQUFiLENBQWdCLGNBQWhCLEVBQWlDLFVBQUQsSUFBNkI7QUFDekQsb0JBQUksT0FBTyxVQUFQLEtBQXNCLFFBQXRCLElBQWtDLGVBQWUsQ0FBckQsRUFDSSxTQURKLEtBR0ksT0FBTyxJQUFJLEtBQUosQ0FDRixnQ0FBOEIsVUFBVyxHQUR2QyxDQUFQO0FBRVAsYUFORDtBQU9KLDJCQUFlLElBQWYsQ0FBb0IsWUFBcEI7QUFDSCxTQWhCb0IsQ0FBckI7QUFpQko7QUFDQTtBQUNDLEtBaEZELE1BZ0ZPLElBQ0gsdUJBQWMsT0FBZCxJQUNBLHVCQUFjLHlCQUFkLENBQXdDLENBQXhDLE1BQStDLFlBRjVDLEVBR0w7QUFDRTtBQUNBLGtCQUFNLHNCQUNGLGlCQUFPLHdCQUFQLENBQ0ksdUJBQWMsYUFBZCxDQUE0QixTQUE1QixDQUFzQyxRQUQxQyxFQUVJLHVCQUFjLE1BQWQsQ0FBcUIsT0FGekIsRUFFa0MsdUJBQWMsZUFGaEQsRUFHSSx1QkFBYyxJQUFkLENBQW1CLE9BSHZCLEVBR2dDLHVCQUFjLElBQWQsQ0FBbUIsTUFIbkQsRUFJRSxTQUxOO0FBTUEsaUJBQUssTUFBTSxrQkFBWCxJQUFpQyxtQkFBakMsRUFDSSxLQUFLLE1BQU0sUUFBWCxJQUE4QixtQkFBbUIsU0FBakQsRUFDSSxJQUFJLENBQUMsb0JBQW9CLFFBQXBCLENBQTZCLFFBQTdCLENBQUwsRUFBNkM7QUFDekMsc0JBQU0scUJBQXFCLENBQ3ZCLE1BRHVCLEVBQ1IsSUFEUSxFQUV2QixrQkFGdUIsRUFFUyxJQUZULEVBR3ZCLG1CQUh1QixFQUdZLFFBSFo7QUFLdkI7QUFDQSxvQkFBSSxRQUFKLENBQ0ksUUFESixFQUNjLE1BRGQsRUFDc0Isb0JBRHRCLEVBQzRDLE1BRDVDLEVBRUkscUJBRkosRUFFMkIsVUFGM0IsRUFFdUMsYUFDbkMsbUJBQ0ksdUJBQWMseUJBQWQsQ0FBd0MsQ0FBeEMsQ0FESixDQURtQyxHQUcvQixHQUxSLEVBT0ksTUFQSixFQU9ZLElBUFosRUFPa0Isa0JBUGxCLEVBT3NDLElBUHRDLEVBUUksbUJBUkosRUFReUIsUUFSekIsQ0FOSjtBQWVBLGdDQUFnQixJQUFoQixDQUFxQixJQUFJLE9BQUosQ0FBWSxDQUM3QixPQUQ2QixFQUU3QixNQUY2QixLQUdmLGlCQUFPLGtCQUFQLENBQ2QseUJBQWlCLG1CQUNiLE1BRGEsMEJBQ1Usa0JBRFYsa0JBRWIsbUJBRmEsRUFFUSxRQUZSLENBQWpCLEVBR0csbUJBSEgsRUFHeUIsS0FBRCxJQUF1QjtBQUMzQyx3QkFBSSxLQUFKLEVBQ0ksT0FBTyxLQUFQLEVBREosS0FHSTtBQUNQLGlCQVJELENBRGMsQ0FIRyxDQUFyQjtBQWFIO0FBQ1o7QUFDRDtBQUNBO0FBQ0EsVUFBTSxhQUFjLElBQUQsSUFBd0IsZ0JBQWdCLElBQWhCLENBQ3ZDLElBQUksT0FBSixDQUFZLENBQ1IsT0FEUSxFQUN5QixNQUR6QixLQUVGO0FBQ04sY0FBTSxlQUE0QiwwQkFDOUIsdUJBQWMsV0FBZCxDQUEwQixJQUExQixFQUFnQyxPQURGLEVBQ1csQ0FDckMsdUJBQWMsV0FBZCxDQUEwQixJQUExQixFQUFnQyxTQUFoQyxJQUE2QyxFQURSLEVBRXZDLE1BRnVDLENBRWhDLG1CQUZnQyxDQURYLEVBR0MsbUJBSEQsQ0FBbEM7QUFJQSxxQkFBYSxFQUFiLENBQWdCLE9BQWhCLEVBQTBCLFVBQUQsSUFBNEI7QUFDakQsZ0JBQUksZUFBZSxDQUFuQixFQUNJLFVBREosS0FHSSxPQUFPLFVBQVA7QUFDUCxTQUxEO0FBTUEsdUJBQWUsSUFBZixDQUFvQixZQUFwQjtBQUNILEtBZEQsQ0FEdUMsQ0FBM0M7QUFnQkE7QUFDQSxTQUFLLE1BQU0sSUFBWCxJQUFtQixDQUFDLFVBQUQsRUFBYSxNQUFiLENBQW5CLEVBQ0ksSUFBSSx1QkFBYyx5QkFBZCxDQUF3QyxDQUF4QyxNQUErQyxJQUFuRCxFQUF5RDtBQUNyRCxnQkFBUSxHQUFSLENBQVksZUFBWixFQUE2QixJQUE3QixDQUFrQyxNQUFhLFdBQVcsSUFBWCxDQUEvQztBQUNBO0FBQ0g7QUFDTDtBQUNBO0FBQ0EsU0FBSyxNQUFNLElBQVgsSUFBbUIsQ0FBQyxNQUFELEVBQVMsZUFBVCxFQUEwQixXQUExQixFQUF1QyxPQUF2QyxDQUFuQixFQUNJLElBQUksdUJBQWMseUJBQWQsQ0FBd0MsQ0FBeEMsTUFBK0MsSUFBbkQsRUFBeUQ7QUFDckQsbUJBQVcsSUFBWDtBQUNBO0FBQ0g7QUFDTDtBQUNBO0FBQ0g7QUFDRCxJQUFJLFdBQW1CLEtBQXZCO0FBQ0EsTUFBTSxlQUFlLFlBQWdCO0FBQ2pDLFFBQUksQ0FBQyxRQUFMLEVBQ0ksS0FBSyxNQUFNLGlCQUFYLElBQXlDLGtCQUF6QyxFQUNJLGtCQUFrQixLQUFsQixDQUF3QixJQUF4QixFQUE4QixTQUE5QjtBQUNSLGVBQVcsSUFBWDtBQUNBLFlBQVEsSUFBUjtBQUNILENBTkQ7QUFPQSxLQUFLLE1BQU0sY0FBWCxJQUFvQyxlQUFwQyxFQUNJLFFBQVEsRUFBUixDQUFXLGNBQVgsRUFBMkIsWUFBM0I7QUFDSixJQUFJLENBQUMsdUJBQWMsT0FBbkIsRUFDSSxrQkFBa0IsSUFBbEIsQ0FBdUIsT0FBdkI7QUFDSjtBQUNBLElBQUksUUFBUSxJQUFSLEtBQWlCLE1BQWpCLEtBQ0EsdUJBQWMseUJBQWQsQ0FBd0MsTUFBeEMsR0FBaUQsQ0FBakQsSUFDQSxDQUFDLGtCQUFrQixRQUFsQixDQUEyQix1QkFBYyx5QkFBZCxDQUF3QyxDQUF4QyxDQUEzQixDQUZELENBQUosRUFJSSxRQUFRLEdBQVIsQ0FDSyxpQkFBZSxrQkFBa0IsSUFBbEIsQ0FBdUIsTUFBdkIsQ0FBK0IscUJBQS9DLEdBQ0EsaUVBREEsR0FFQSw4Q0FISjtBQUlKO0FBQ0E7QUFDQSxRQUFRLEdBQVIsQ0FBWSxlQUFaLEVBQTZCLEtBQTdCLENBQW9DLFVBQUQsSUFBNEIsUUFBUSxJQUFSLENBQzNELFVBRDJELENBQS9EO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJ0YXNrUnVubmVyLmNvbXBpbGVkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIyEvdXNyL2Jpbi9lbnYgbm9kZVxuLy8gQGZsb3dcbi8vIC0qLSBjb2Rpbmc6IHV0Zi04IC0qLVxuJ3VzZSBzdHJpY3QnXG4vKiAhXG4gICAgcmVnaW9uIGhlYWRlclxuICAgIENvcHlyaWdodCBUb3JiZW4gU2lja2VydCAoaW5mb1tcIn5hdH5cIl10b3JiZW4ud2Vic2l0ZSkgMTYuMTIuMjAxMlxuXG4gICAgTGljZW5zZVxuICAgIC0tLS0tLS1cblxuICAgIFRoaXMgbGlicmFyeSB3cml0dGVuIGJ5IFRvcmJlbiBTaWNrZXJ0IHN0YW5kIHVuZGVyIGEgY3JlYXRpdmUgY29tbW9ucyBuYW1pbmdcbiAgICAzLjAgdW5wb3J0ZWQgbGljZW5zZS4gc2VlIGh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LzMuMC9kZWVkLmRlXG4gICAgZW5kcmVnaW9uXG4qL1xuLy8gcmVnaW9uIGltcG9ydHNcbmltcG9ydCB7XG4gICAgQ2hpbGRQcm9jZXNzLCBleGVjIGFzIGV4ZWNDaGlsZFByb2Nlc3MsIHNwYXduIGFzIHNwYXduQ2hpbGRQcm9jZXNzXG59IGZyb20gJ2NoaWxkX3Byb2Nlc3MnXG5pbXBvcnQgKiBhcyBmaWxlU3lzdGVtIGZyb20gJ2ZzJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCB7c3luYyBhcyByZW1vdmVEaXJlY3RvcnlSZWN1cnNpdmVseVN5bmN9IGZyb20gJ3JpbXJhZidcbi8vIE5PVEU6IE9ubHkgbmVlZGVkIGZvciBkZWJ1Z2dpbmcgdGhpcyBmaWxlLlxudHJ5IHtcbiAgICByZXF1aXJlKCdzb3VyY2UtbWFwLXN1cHBvcnQvcmVnaXN0ZXInKVxufSBjYXRjaCAoZXJyb3IpIHt9XG5cbmltcG9ydCBjb25maWd1cmF0aW9uIGZyb20gJy4vY29uZmlndXJhdG9yLmNvbXBpbGVkJ1xuaW1wb3J0IHR5cGUge1xuICAgIE5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbiwgUGxhaW5PYmplY3QsIFByb21pc2VDYWxsYmFja0Z1bmN0aW9uLFxuICAgIFJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uLCBSZXNvbHZlZENvbmZpZ3VyYXRpb25cbn0gZnJvbSAnLi90eXBlJ1xuaW1wb3J0IEhlbHBlciBmcm9tICcuL2hlbHBlci5jb21waWxlZCdcbi8vIGVuZHJlZ2lvblxuLy8gcmVnaW9uIGNvbnRyb2xsZXJcbmNvbnN0IGNoaWxkUHJvY2Vzc09wdGlvbnM6T2JqZWN0ID0ge1xuICAgIGN3ZDogY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsXG4gICAgZW52OiBwcm9jZXNzLmVudixcbiAgICBzaGVsbDogdHJ1ZSxcbiAgICBzdGRpbzogJ2luaGVyaXQnXG59XG5jb25zdCBjbG9zZUV2ZW50TmFtZXM6QXJyYXk8c3RyaW5nPiA9IFtcbiAgICAnZXhpdCcsICdjbG9zZScsICd1bmNhdWdodEV4Y2VwdGlvbicsICdTSUdJTlQnLCAnU0lHVEVSTScsICdTSUdRVUlUJ11cbmNvbnN0IGNoaWxkUHJvY2Vzc2VzOkFycmF5PENoaWxkUHJvY2Vzcz4gPSBbXVxuY29uc3QgcHJvY2Vzc1Byb21pc2VzOkFycmF5PFByb21pc2U8YW55Pj4gPSBbXVxuY29uc3QgcG9zc2libGVBcmd1bWVudHM6QXJyYXk8c3RyaW5nPiA9IFtcbiAgICAnYnVpbGQnLCAnYnVpbGRETEwnLCAnY2xlYXInLCAnZG9jdW1lbnQnLCAnbGludCcsICdwcmVpbnN0YWxsJywgJ3Rlc3QnLFxuICAgICd0ZXN0SW5Ccm93c2VyJywgJ3R5cGVDaGVjaydcbl1cbmNvbnN0IGNsb3NlRXZlbnRIYW5kbGVyczpBcnJheTxGdW5jdGlvbj4gPSBbXVxuaWYgKGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50cy5sZW5ndGggPiAyKSB7XG4gICAgLy8gcmVnaW9uIHRlbXBvcmFyeSBzYXZlIGR5bmFtaWNhbGx5IGdpdmVuIGNvbmZpZ3VyYXRpb25zXG4gICAgLy8gTk9URTogV2UgbmVlZCBhIGNvcHkgb2YgZ2l2ZW4gYXJndW1lbnRzIGFycmF5LlxuICAgIGxldCBkeW5hbWljQ29uZmlndXJhdGlvbjpQbGFpbk9iamVjdCA9IHtcbiAgICAgICAgZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50czpcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50cy5zbGljZSgpfVxuICAgIGlmIChjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoID4gMykge1xuICAgICAgICBjb25zdCBldmFsdWF0aW9uRnVuY3Rpb24gPSAoXG4gICAgICAgICAgICBjb25maWd1cmF0aW9uOlJlc29sdmVkQ29uZmlndXJhdGlvblxuICAgICAgICApOj9QbGFpbk9iamVjdCA9PlxuICAgICAgICAgICAgLy8gSWdub3JlVHlwZUNoZWNrXG4gICAgICAgICAgICBuZXcgRnVuY3Rpb24oJ2NvbmZpZ3VyYXRpb24nLCAncmV0dXJuICcgK1xuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1tcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLmxlbmd0aCAtIDFdXG4gICAgICAgICAgICApKGNvbmZpZ3VyYXRpb24pXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoSGVscGVyLmlzUGxhaW5PYmplY3QoZXZhbHVhdGlvbkZ1bmN0aW9uKGNvbmZpZ3VyYXRpb24pKSlcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMucG9wKClcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHt9XG4gICAgfVxuICAgIGxldCBjb3VudDpudW1iZXIgPSAwXG4gICAgbGV0IGZpbGVQYXRoOnN0cmluZyA9IGAke2NvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0fS5gICtcbiAgICAgICAgYGR5bmFtaWNDb25maWd1cmF0aW9uLSR7Y291bnR9Lmpzb25gXG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgZmlsZVBhdGggPSBgJHtjb25maWd1cmF0aW9uLnBhdGguY29udGV4dH0uZHluYW1pY0NvbmZpZ3VyYXRpb24tYCArXG4gICAgICAgICAgICBgJHtjb3VudH0uanNvbmBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZpbGVTeXN0ZW0uYWNjZXNzU3luYyhmaWxlUGF0aCwgZmlsZVN5c3RlbS5GX09LKVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgICBjb3VudCArPSAxXG4gICAgfVxuICAgIGZpbGVTeXN0ZW0ud3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkoZHluYW1pY0NvbmZpZ3VyYXRpb24pKVxuICAgIGNvbnN0IGFkZGl0aW9uYWxBcmd1bWVudHM6QXJyYXk8c3RyaW5nPiA9IHByb2Nlc3MuYXJndi5zcGxpY2UoMylcbiAgICAvLyAvIHJlZ2lvbiByZWdpc3RlciBleGl0IGhhbmRsZXIgdG8gdGlkeSB1cFxuICAgIGNsb3NlRXZlbnRIYW5kbGVycy5wdXNoKGZ1bmN0aW9uKGVycm9yOj9FcnJvcik6P0Vycm9yIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZpbGVTeXN0ZW0udW5saW5rU3luYyhmaWxlUGF0aClcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHt9XG4gICAgICAgIGlmIChlcnJvcilcbiAgICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIHJldHVybiBlcnJvclxuICAgIH0pXG4gICAgLy8gLyBlbmRyZWdpb25cbiAgICAvLyBlbmRyZWdpb25cbiAgICAvLyByZWdpb24gaGFuZGxlIGNsZWFyXG4gICAgLypcbiAgICAgICAgTk9URTogQSBidWlsZCBjb3VsZCBkZXBlbmQgb24gcHJldmlvdXNseSBjcmVhdGVkIGRsbCBwYWNrYWdlcyBzbyBhXG4gICAgICAgIGNsZWFuIHNob3VsZCBub3QgYmUgcGVyZm9ybWVkIGluIHRoYXQgY2FzZS5cbiAgICAqL1xuICAgIGlmICghWydidWlsZCcsICdzZXJ2ZScsICd0ZXN0SW5Ccm93c2VyJ10uaW5jbHVkZXMoXG4gICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXVxuICAgICkgJiYgcG9zc2libGVBcmd1bWVudHMuaW5jbHVkZXMoXG4gICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXVxuICAgICkpIHtcbiAgICAgICAgaWYgKHBhdGgucmVzb2x2ZShjb25maWd1cmF0aW9uLnBhdGgudGFyZ2V0KSA9PT0gcGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHRcbiAgICAgICAgKSkge1xuICAgICAgICAgICAgLy8gUmVtb3ZlcyBhbGwgY29tcGlsZWQgZmlsZXMuXG4gICAgICAgICAgICBIZWxwZXIud2Fsa0RpcmVjdG9yeVJlY3Vyc2l2ZWx5U3luYyhjb25maWd1cmF0aW9uLnBhdGgudGFyZ2V0LCAoXG4gICAgICAgICAgICAgICAgZmlsZVBhdGg6c3RyaW5nLCBzdGF0Ok9iamVjdFxuICAgICAgICAgICAgKTo/Ym9vbGVhbiA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKEhlbHBlci5pc0ZpbGVQYXRoSW5Mb2NhdGlvbihcbiAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGgsIGNvbmZpZ3VyYXRpb24ucGF0aC5pZ25vcmVcbiAgICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHR5cGU6c3RyaW5nIGluIGNvbmZpZ3VyYXRpb24uYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXcgUmVnRXhwKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5idWlsZFt0eXBlXS5maWxlTmFtZVBhdHRlcm5cbiAgICAgICAgICAgICAgICAgICAgKS50ZXN0KGZpbGVQYXRoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXQuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZURpcmVjdG9yeVJlY3Vyc2l2ZWx5U3luYyhmaWxlUGF0aCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iOiBmYWxzZX0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnVubGlua1N5bmMoZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgZmlsZVN5c3RlbS5yZWFkZGlyU3luYyhjb25maWd1cmF0aW9uLnBhdGgudGFyZ2V0KS5mb3JFYWNoKChcbiAgICAgICAgICAgICAgICBmaWxlTmFtZTpzdHJpbmdcbiAgICAgICAgICAgICk6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZS5sZW5ndGggPiAnLmRsbC1tYW5pZmVzdC5qc29uJy5sZW5ndGggJiZcbiAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUuZW5kc1dpdGgoJy5kbGwtbWFuaWZlc3QuanNvbicpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnVubGlua1N5bmMocGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldCwgZmlsZU5hbWUpKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICByZW1vdmVEaXJlY3RvcnlSZWN1cnNpdmVseVN5bmMoY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldCwge1xuICAgICAgICAgICAgICAgIGdsb2I6IGZhbHNlfSlcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJlbW92ZURpcmVjdG9yeVJlY3Vyc2l2ZWx5U3luYyhcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguYXBpRG9jdW1lbnRhdGlvbiwge2dsb2I6IGZhbHNlfSlcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHt9XG4gICAgfVxuICAgIC8vIGVuZHJlZ2lvblxuICAgIC8vIHJlZ2lvbiBoYW5kbGUgYnVpbGRcbiAgICBjb25zdCBidWlsZENvbmZpZ3VyYXRpb25zOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uID1cbiAgICAgICAgSGVscGVyLnJlc29sdmVCdWlsZENvbmZpZ3VyYXRpb25GaWxlUGF0aHMoXG4gICAgICAgICAgICBjb25maWd1cmF0aW9uLmJ1aWxkLCBjb25maWd1cmF0aW9uLnBhdGguYXNzZXQuc291cmNlLFxuICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsIGNvbmZpZ3VyYXRpb24ucGF0aC5pZ25vcmUpXG4gICAgaWYgKFsnYnVpbGQnLCAnYnVpbGRETEwnLCAnZG9jdW1lbnQnLCAndGVzdCddLmluY2x1ZGVzKHByb2Nlc3MuYXJndlsyXSkpIHtcbiAgICAgICAgY29uc3QgdGlkeVVwID0gKCk6dm9pZCA9PiB7XG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgIERldGVybWluZXMgYWxsIG5vbmUgamF2YVNjcmlwdCBlbnRpdGllcyB3aGljaCBoYXZlIGJlZW4gZW1pdHRlZFxuICAgICAgICAgICAgICAgIGFzIHNpbmdsZSBqYXZhU2NyaXB0IG1vZHVsZSB0byByZW1vdmUuXG4gICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29uc3QgaW50ZXJuYWxJbmplY3Rpb246Tm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uID1cbiAgICAgICAgICAgICAgICBIZWxwZXIubm9ybWFsaXplSW50ZXJuYWxJbmplY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgIEhlbHBlci5yZXNvbHZlSW5qZWN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5pbmplY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi50ZXN0SW5Ccm93c2VyLmluamVjdGlvbi5pbnRlcm5hbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubW9kdWxlLmFsaWFzZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmtub3duRXh0ZW5zaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmlnbm9yZVxuICAgICAgICAgICAgICAgICAgICApLmludGVybmFsKVxuICAgICAgICAgICAgZm9yIChjb25zdCBjaHVua05hbWU6c3RyaW5nIGluIGludGVybmFsSW5qZWN0aW9uKVxuICAgICAgICAgICAgICAgIGlmIChpbnRlcm5hbEluamVjdGlvbi5oYXNPd25Qcm9wZXJ0eShjaHVua05hbWUpKVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1vZHVsZUlEOnN0cmluZyBvZiBpbnRlcm5hbEluamVjdGlvbltcbiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rTmFtZVxuICAgICAgICAgICAgICAgICAgICBdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlOj9zdHJpbmcgPSBIZWxwZXIuZGV0ZXJtaW5lQXNzZXRUeXBlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlbHBlci5kZXRlcm1pbmVNb2R1bGVGaWxlUGF0aChtb2R1bGVJRCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5idWlsZCwgY29uZmlndXJhdGlvbi5wYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyByZXBsYWNlIGFsbCBwbGFjZWhvbGRlciBsaWtlIFtoYXNoXSBbaWRdIC4uLlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZVBhdGg6c3RyaW5nID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmZpbGVzLmphdmFTY3JpcHQucmVwbGFjZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1tuYW1lXScsIHBhdGguam9pbihwYXRoLnJlbGF0aXZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aC5kaXJuYW1lKG1vZHVsZUlEKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksIHBhdGguYmFzZW5hbWUobW9kdWxlSUQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkucmVwbGFjZSgvXFw/W14/XSskLywgJycpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHR5cGUgPT09ICdzdHJpbmcnICYmIGNvbmZpZ3VyYXRpb24uYnVpbGRbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlndXJhdGlvbi5idWlsZFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0ub3V0cHV0RXh0ZW5zaW9uID09PSAnanMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbS5jaG1vZFN5bmMoZmlsZVBhdGgsICc3NTUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc3VmZml4OnN0cmluZyBvZiBbJycsICcubWFwJ10pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVTeXN0ZW0udW5saW5rU3luYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGggKyBzdWZmaXgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge31cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlUGF0aDpzdHJpbmcgb2YgY29uZmlndXJhdGlvbi5wYXRoLnRpZHlVcFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVTeXN0ZW0udW5saW5rU3luYyhmaWxlUGF0aClcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge31cbiAgICAgICAgfVxuICAgICAgICBjbG9zZUV2ZW50SGFuZGxlcnMucHVzaCh0aWR5VXApXG4gICAgICAgIC8qXG4gICAgICAgICAgICBUcmlnZ2VycyBjb21wbGV0ZSBhc3NldCBjb21waWxpbmcgYW5kIGJ1bmRsZXMgdGhlbSBpbnRvIHRoZSBmaW5hbFxuICAgICAgICAgICAgcHJvZHVjdGl2ZSBvdXRwdXQuXG4gICAgICAgICovXG4gICAgICAgIHByb2Nlc3NQcm9taXNlcy5wdXNoKG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgIHJlc29sdmU6UHJvbWlzZUNhbGxiYWNrRnVuY3Rpb24sIHJlamVjdDpQcm9taXNlQ2FsbGJhY2tGdW5jdGlvblxuICAgICAgICApOnZvaWQgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzOkNoaWxkUHJvY2VzcyA9IHNwYXduQ2hpbGRQcm9jZXNzKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uY29tbWFuZExpbmUuYnVpbGQuY29tbWFuZCwgKFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lLmJ1aWxkLmFyZ3VtZW50cyB8fCBbXVxuICAgICAgICAgICAgICAgICkuY29uY2F0KGFkZGl0aW9uYWxBcmd1bWVudHMpLCBjaGlsZFByb2Nlc3NPcHRpb25zKVxuICAgICAgICAgICAgZm9yIChjb25zdCBjbG9zZUV2ZW50TmFtZTpzdHJpbmcgb2YgY2xvc2VFdmVudE5hbWVzKVxuICAgICAgICAgICAgICAgIGNoaWxkUHJvY2Vzcy5vbihjbG9zZUV2ZW50TmFtZSwgKHJldHVybkNvZGU6P251bWJlcik6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmV0dXJuQ29kZSAhPT0gJ251bWJlcicgfHwgcmV0dXJuQ29kZSA9PT0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpZHlVcCgpXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYFRhc2sgZXhpdGVkIHdpdGggZXJyb3IgY29kZSAke3JldHVybkNvZGV9YCkpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIGNoaWxkUHJvY2Vzc2VzLnB1c2goY2hpbGRQcm9jZXNzKVxuICAgICAgICB9KSlcbiAgICAvLyBlbmRyZWdpb25cbiAgICAvLyByZWdpb24gaGFuZGxlIHByZWluc3RhbGxcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgICBjb25maWd1cmF0aW9uLmxpYnJhcnkgJiZcbiAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdID09PSAncHJlaW5zdGFsbCdcbiAgICApIHtcbiAgICAgICAgLy8gUGVyZm9ybSBhbGwgZmlsZSBzcGVjaWZpYyBwcmVwcm9jZXNzaW5nIHN0dWZmLlxuICAgICAgICBjb25zdCB0ZXN0TW9kdWxlRmlsZVBhdGhzOkFycmF5PHN0cmluZz4gPVxuICAgICAgICAgICAgSGVscGVyLmRldGVybWluZU1vZHVsZUxvY2F0aW9ucyhcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnRlc3RJbkJyb3dzZXIuaW5qZWN0aW9uLmludGVybmFsLFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubW9kdWxlLmFsaWFzZXMsIGNvbmZpZ3VyYXRpb24ua25vd25FeHRlbnNpb25zLFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LCBjb25maWd1cmF0aW9uLnBhdGguaWdub3JlXG4gICAgICAgICAgICApLmZpbGVQYXRoc1xuICAgICAgICBmb3IgKGNvbnN0IGJ1aWxkQ29uZmlndXJhdGlvbiBvZiBidWlsZENvbmZpZ3VyYXRpb25zKVxuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlUGF0aDpzdHJpbmcgb2YgYnVpbGRDb25maWd1cmF0aW9uLmZpbGVQYXRocylcbiAgICAgICAgICAgICAgICBpZiAoIXRlc3RNb2R1bGVGaWxlUGF0aHMuaW5jbHVkZXMoZmlsZVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2YWx1YXRpb25GdW5jdGlvbiA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbDpPYmplY3QsIHNlbGY6UGxhaW5PYmplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb246UGxhaW5PYmplY3QsIHBhdGg6dHlwZW9mIHBhdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRpdGlvbmFsQXJndW1lbnRzOkFycmF5PHN0cmluZz4sIGZpbGVQYXRoOnN0cmluZ1xuICAgICAgICAgICAgICAgICAgICApOnN0cmluZyA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlVHlwZUNoZWNrXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgRnVuY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2dsb2JhbCcsICdzZWxmJywgJ2J1aWxkQ29uZmlndXJhdGlvbicsICdwYXRoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWRkaXRpb25hbEFyZ3VtZW50cycsICdmaWxlUGF0aCcsICdyZXR1cm4gYCcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkQ29uZmlndXJhdGlvbltcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSArICdgJ1xuICAgICAgICAgICAgICAgICAgICAgICAgKShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwsIHNlbGYsIGJ1aWxkQ29uZmlndXJhdGlvbiwgcGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRpdGlvbmFsQXJndW1lbnRzLCBmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Byb21pc2VzLnB1c2gobmV3IFByb21pc2UoKFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpQcm9taXNlQ2FsbGJhY2tGdW5jdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdDpQcm9taXNlQ2FsbGJhY2tGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICApOkNoaWxkUHJvY2VzcyA9PiBIZWxwZXIuaGFuZGxlQ2hpbGRQcm9jZXNzKFxuICAgICAgICAgICAgICAgICAgICAgICAgZXhlY0NoaWxkUHJvY2VzcyhldmFsdWF0aW9uRnVuY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLCBjb25maWd1cmF0aW9uLCBidWlsZENvbmZpZ3VyYXRpb24sIHBhdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbEFyZ3VtZW50cywgZmlsZVBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgICksIGNoaWxkUHJvY2Vzc09wdGlvbnMsIChlcnJvcjo/RXJyb3IpOnZvaWQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSkpKVxuICAgICAgICAgICAgICAgIH1cbiAgICB9XG4gICAgLy8gZW5kcmVnaW9uXG4gICAgLy8gcmVnaW9uIGhhbmRsZSByZW1haW5pbmcgdGFza3NcbiAgICBjb25zdCBoYW5kbGVUYXNrID0gKHR5cGU6c3RyaW5nKTpudW1iZXIgPT4gcHJvY2Vzc1Byb21pc2VzLnB1c2goXG4gICAgICAgIG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgIHJlc29sdmU6UHJvbWlzZUNhbGxiYWNrRnVuY3Rpb24sIHJlamVjdDpQcm9taXNlQ2FsbGJhY2tGdW5jdGlvblxuICAgICAgICApOnZvaWQgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzOkNoaWxkUHJvY2VzcyA9IHNwYXduQ2hpbGRQcm9jZXNzKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uY29tbWFuZExpbmVbdHlwZV0uY29tbWFuZCwgKFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lW3R5cGVdLmFyZ3VtZW50cyB8fCBbXVxuICAgICAgICAgICAgICAgICkuY29uY2F0KGFkZGl0aW9uYWxBcmd1bWVudHMpLCBjaGlsZFByb2Nlc3NPcHRpb25zKVxuICAgICAgICAgICAgY2hpbGRQcm9jZXNzLm9uKCdjbG9zZScsIChyZXR1cm5Db2RlOm51bWJlcik6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJldHVybkNvZGUgPT09IDApXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJldHVybkNvZGUpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgY2hpbGRQcm9jZXNzZXMucHVzaChjaGlsZFByb2Nlc3MpXG4gICAgICAgIH0pKVxuICAgIC8vIC8gcmVnaW9uIHN5bmNocm9ub3VzXG4gICAgZm9yIChjb25zdCB0eXBlIG9mIFsnZG9jdW1lbnQnLCAndGVzdCddKVxuICAgICAgICBpZiAoY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdID09PSB0eXBlKSB7XG4gICAgICAgICAgICBQcm9taXNlLmFsbChwcm9jZXNzUHJvbWlzZXMpLnRoZW4oKCk6bnVtYmVyID0+IGhhbmRsZVRhc2sodHlwZSkpXG4gICAgICAgICAgICBicmVha1xuICAgICAgICB9XG4gICAgLy8gLyBlbmRyZWdpb25cbiAgICAvLyAvIHJlZ2lvbiBhc3luY2hyb25vdXNcbiAgICBmb3IgKGNvbnN0IHR5cGUgb2YgWydsaW50JywgJ3Rlc3RJbkJyb3dzZXInLCAndHlwZUNoZWNrJywgJ3NlcnZlJ10pXG4gICAgICAgIGlmIChjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0gPT09IHR5cGUpIHtcbiAgICAgICAgICAgIGhhbmRsZVRhc2sodHlwZSlcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cbiAgICAvLyAvIGVuZHJlZ2lvblxuICAgIC8vIGVuZHJlZ2lvblxufVxubGV0IGZpbmlzaGVkOmJvb2xlYW4gPSBmYWxzZVxuY29uc3QgY2xvc2VIYW5kbGVyID0gZnVuY3Rpb24oKTp2b2lkIHtcbiAgICBpZiAoIWZpbmlzaGVkKVxuICAgICAgICBmb3IgKGNvbnN0IGNsb3NlRXZlbnRIYW5kbGVyOkZ1bmN0aW9uIG9mIGNsb3NlRXZlbnRIYW5kbGVycylcbiAgICAgICAgICAgIGNsb3NlRXZlbnRIYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcbiAgICBmaW5pc2hlZCA9IHRydWVcbiAgICBwcm9jZXNzLmV4aXQoKVxufVxuZm9yIChjb25zdCBjbG9zZUV2ZW50TmFtZTpzdHJpbmcgb2YgY2xvc2VFdmVudE5hbWVzKVxuICAgIHByb2Nlc3Mub24oY2xvc2VFdmVudE5hbWUsIGNsb3NlSGFuZGxlcilcbmlmICghY29uZmlndXJhdGlvbi5saWJyYXJ5KVxuICAgIHBvc3NpYmxlQXJndW1lbnRzLnB1c2goJ3NlcnZlJylcbi8vIElnbm9yZVR5cGVDaGVja1xuaWYgKHJlcXVpcmUubWFpbiA9PT0gbW9kdWxlICYmIChcbiAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoIDwgMyB8fFxuICAgICFwb3NzaWJsZUFyZ3VtZW50cy5pbmNsdWRlcyhjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0pXG4pKVxuICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBgR2l2ZSBvbmUgb2YgXCIke3Bvc3NpYmxlQXJndW1lbnRzLmpvaW4oJ1wiLCBcIicpfVwiIGFzIGNvbW1hbmQgbGluZSBgICtcbiAgICAgICAgJ2FyZ3VtZW50LiBZb3UgY2FuIHByb3ZpZGUgYSBqc29uIHN0cmluZyBhcyBzZWNvbmQgcGFyYW1ldGVyIHRvICcgK1xuICAgICAgICAnZHluYW1pY2FsbHkgb3ZlcndyaXRlIHNvbWUgY29uZmlndXJhdGlvbnMuXFxuJylcbi8vIGVuZHJlZ2lvblxuLy8gcmVnaW9uIGZvcndhcmQgbmVzdGVkIHJldHVybiBjb2Rlc1xuUHJvbWlzZS5hbGwocHJvY2Vzc1Byb21pc2VzKS5jYXRjaCgocmV0dXJuQ29kZTpudW1iZXIpOnZvaWQgPT4gcHJvY2Vzcy5leGl0KFxuICAgIHJldHVybkNvZGUpKVxuLy8gZW5kcmVnaW9uXG4vLyByZWdpb24gdmltIG1vZGxpbmVcbi8vIHZpbTogc2V0IHRhYnN0b3A9NCBzaGlmdHdpZHRoPTQgZXhwYW5kdGFiOlxuLy8gdmltOiBmb2xkbWV0aG9kPW1hcmtlciBmb2xkbWFya2VyPXJlZ2lvbixlbmRyZWdpb246XG4vLyBlbmRyZWdpb25cbiJdfQ==